<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Müddetname v1.2 - Mobil Uyumlu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Mobil klavye açıldığında inputların daha rahat görünmesi için */
        input, select { font-size: 16px !important; } 
    </style>
</head>
<body class="bg-slate-100 text-slate-900 antialiased">

<div class="max-w-4xl mx-auto pb-24 md:p-6">
    <div class="bg-white p-6 md:rounded-2xl shadow-sm border-b md:border-t-8 border-indigo-600 mb-4">
        <h1 class="text-2xl font-black text-slate-800 flex items-center gap-2">
            <span>⚖️</span> Müddetname Hesapla
        </h1>
        <p class="text-slate-500 text-sm mt-1">İlam ve mahsup bilgilerini giriniz.</p>
    </div>

    <div class="px-4 space-y-6">
        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-indigo-700 uppercase text-sm tracking-wider">1. Cezalar (İlamlar)</h2>
                <button onclick="ilamEkle()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-xs font-bold active:scale-95 transition-transform">
                    + İlam Ekle
                </button>
            </div>
            
            <div id="ilamListesi" class="space-y-4">
                <div class="ilam-item bg-slate-50 p-4 rounded-xl border border-slate-200 relative group">
                    <div class="grid grid-cols-3 gap-3 mb-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Yıl</label>
                            <input type="number" class="ilam-yil w-full p-3 bg-white border rounded-lg focus:ring-2 ring-indigo-500 outline-none" placeholder="0">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Ay</label>
                            <input type="number" class="ilam-ay w-full p-3 bg-white border rounded-lg focus:ring-2 ring-indigo-500 outline-none" placeholder="0">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Gün</label>
                            <input type="number" class="ilam-gun w-full p-3 bg-white border rounded-lg focus:ring-2 ring-indigo-500 outline-none" placeholder="0">
                        </div>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">İnfaz Oranı</label>
                        <select class="ilam-oran w-full p-3 bg-white border rounded-lg focus:ring-2 ring-indigo-500 outline-none">
                            <option value="1/2">1/2 (Adi Suçlar)</option>
                            <option value="2/3">2/3 (Kasten / Mükerrir)</option>
                            <option value="3/4">3/4 (Terör / Örgüt)</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
            <div class="flex flex-col gap-3 mb-4">
                <h2 class="font-bold text-red-600 uppercase text-sm tracking-wider">2. Mahsup (Gözaltı/Tutuk)</h2>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="mahsupEkle('tarih')" class="bg-red-50 text-red-700 border border-red-100 py-2 rounded-lg text-xs font-bold hover:bg-red-100 transition-colors">
                        + Tarih Aralığı
                    </button>
                    <button onclick="mahsupEkle('manuel')" class="bg-orange-50 text-orange-700 border border-orange-100 py-2 rounded-lg text-xs font-bold hover:bg-orange-100 transition-colors">
                        + Manuel Gün
                    </button>
                </div>
            </div>
            <div id="mahsupListesi" class="space-y-3"></div>
        </section>

        <section class="bg-amber-50 p-4 rounded-2xl border border-amber-200">
            <label class="block text-sm font-bold text-amber-800 mb-2 italic">Son Cezaevine Giriş Tarihi</label>
            <input type="date" id="sonGiris" class="w-full p-3 border border-amber-300 rounded-xl focus:ring-2 ring-amber-500 outline-none bg-white">
        </section>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-slate-900 text-white p-4 shadow-[0_-10px_25px_rgba(0,0,0,0.1)] md:relative md:mt-8 md:rounded-2xl md:bg-slate-900">
        <div class="max-w-4xl mx-auto">
            <div class="flex items-center justify-between mb-3 md:hidden" id="summaryToggle" onclick="document.getElementById('fullSummary').classList.toggle('hidden')">
                <div class="flex flex-col">
                    <span class="text-[10px] text-slate-400 uppercase tracking-widest">Tahliye Tarihi</span>
                    <span id="resTahliyeMobile" class="text-xl font-black text-indigo-400">---</span>
                </div>
                <button onclick="fullHesapla()" class="bg-indigo-600 px-6 py-3 rounded-xl font-bold text-sm shadow-lg active:scale-95">HESAPLA</button>
            </div>

            <div id="fullSummary" class="hidden md:block space-y-3 pb-2 transition-all">
                <div class="grid grid-cols-2 gap-4 text-center border-b border-slate-700 pb-3">
                    <div>
                        <p class="text-[10px] text-slate-400 uppercase">Toplam Ceza</p>
                        <p id="resYalin" class="font-mono text-sm">0 Gün</p>
                    </div>
                    <div>
                        <p class="text-[10px] text-slate-400 uppercase">Mahsup</p>
                        <p id="resMahsup" class="font-mono text-red-400 text-sm">0 Gün</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="bg-indigo-500/10 p-3 rounded-lg border border-indigo-500/20">
                        <p class="text-[9px] text-indigo-300 uppercase font-bold">Koşullu Salıverilme</p>
                        <p id="resTahliye" class="text-lg font-bold">---</p>
                        <p id="resKalanYatar" class="text-[10px] text-indigo-200 italic">Kalan: 0 gün</p>
                    </div>
                    <div class="bg-slate-800 p-3 rounded-lg">
                        <p class="text-[9px] text-slate-400 uppercase font-bold">Bihakkın Tahliye</p>
                        <p id="resBihakkin" class="text-lg font-bold text-slate-200">---</p>
                    </div>
                </div>
                <button onclick="fullHesapla()" class="hidden md:block w-full py-3 bg-indigo-600 rounded-xl font-bold mt-2">HESAPLA</button>
            </div>
        </div>
    </div>
</div>

<script>
    function ilamEkle() {
        const div = document.createElement('div');
        div.className = "ilam-item bg-slate-50 p-4 rounded-xl border border-slate-200 relative animate-in fade-in duration-300";
        div.innerHTML = `
            <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-xs shadow-lg">✕</button>
            <div class="grid grid-cols-3 gap-3 mb-3">
                <input type="number" placeholder="Yıl" class="ilam-yil w-full p-3 border rounded-lg">
                <input type="number" placeholder="Ay" class="ilam-ay w-full p-3 border rounded-lg">
                <input type="number" placeholder="Gün" class="ilam-gun w-full p-3 border rounded-lg">
            </div>
            <select class="ilam-oran w-full p-3 border rounded-lg bg-white">
                <option value="1/2">1/2 (Adi Suçlar)</option>
                <option value="2/3">2/3 (Kasten / Mükerrir)</option>
                <option value="3/4">3/4 (Terör / Örgüt)</option>
            </select>
        `;
        document.getElementById('ilamListesi').appendChild(div);
    }

    function mahsupEkle(tip) {
        const div = document.createElement('div');
        div.className = "mahsup-item p-4 rounded-xl border relative animate-in slide-in-from-top-2";
        
        if(tip === 'tarih') {
            div.classList.add('bg-red-50', 'border-red-100');
            div.innerHTML = `
                <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-lg text-xs">✕</button>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[9px] font-bold text-red-400 uppercase">Giriş</label><input type="date" class="mahsup-giris w-full p-2 border rounded-lg bg-white"></div>
                    <div><label class="text-[9px] font-bold text-red-400 uppercase">Çıkış</label><input type="date" class="mahsup-cikis w-full p-2 border rounded-lg bg-white"></div>
                </div>
                <input type="hidden" class="mahsup-tip" value="tarih">
            `;
        } else {
            div.classList.add('bg-orange-50', 'border-orange-100');
            div.innerHTML = `
                <button onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 bg-orange-600 text-white rounded-full w-7 h-7 flex items-center justify-center shadow-lg text-xs">✕</button>
                <label class="text-[9px] font-bold text-orange-400 uppercase">Manuel Gün Sayısı</label>
                <input type="number" class="mahsup-manuel-gun w-full p-3 border border-orange-200 rounded-lg bg-white" placeholder="Örn: 45">
                <input type="hidden" class="mahsup-tip" value="manuel">
            `;
        }
        document.getElementById('mahsupListesi').appendChild(div);
    }

    function fullHesapla() {
        let toplamYalinGun = 0;
        let toplamYatarGun = 0;
        let toplamMahsupGun = 0;

        document.querySelectorAll('.ilam-item').forEach(item => {
            let y = parseInt(item.querySelector('.ilam-yil').value) || 0;
            let a = parseInt(item.querySelector('.ilam-ay').value) || 0;
            let g = parseInt(item.querySelector('.ilam-gun').value) || 0;
            let oranStr = item.querySelector('.ilam-oran').value;
            let oran = oranStr === "1/2" ? 0.5 : (oranStr === "2/3" ? 2/3 : 3/4);
            
            let yalin = (y * 365) + (a * 30) + g;
            toplamYalinGun += yalin;
            toplamYatarGun += Math.floor(yalin * oran);
        });

        document.querySelectorAll('.mahsup-item').forEach(item => {
            const tip = item.querySelector('.mahsup-tip').value;
            if(tip === 'tarih') {
                let g = new Date(item.querySelector('.mahsup-giris').value);
                let c = new Date(item.querySelector('.mahsup-cikis').value);
                if(!isNaN(g) && !isNaN(c)) {
                    let fark = (c - g) / (1000 * 60 * 60 * 24);
                    if(fark > 0) toplamMahsupGun += Math.floor(fark);
                }
            } else {
                let manuel = parseInt(item.querySelector('.mahsup-manuel-gun').value) || 0;
                toplamMahsupGun += manuel;
            }
        });

        const netYatar = toplamYatarGun - toplamMahsupGun;
        const netBihakkin = toplamYalinGun - toplamMahsupGun;
        const girisTarihiInput = document.getElementById('sonGiris').value;

        document.getElementById('resYalin').innerText = toplamYalinGun + " Gün";
        document.getElementById('resMahsup').innerText = toplamMahsupGun + " Gün";
        document.getElementById('resKalanYatar').innerText = "Kalan: " + (netYatar > 0 ? netYatar : 0) + " gün";

        if(girisTarihiInput) {
            let giris = new Date(girisTarihiInput);
            
            let tahliye = new Date(giris);
            tahliye.setDate(tahliye.getDate() + (netYatar > 0 ? netYatar : 0));
            const tahliyeStr = tahliye.toLocaleDateString('tr-TR');
            document.getElementById('resTahliye').innerText = tahliyeStr;
            document.getElementById('resTahliyeMobile').innerText = tahliyeStr;

            let bihakkin = new Date(giris);
            bihakkin.setDate(bihakkin.getDate() + (netBihakkin > 0 ? netBihakkin : 0));
            document.getElementById('resBihakkin').innerText = bihakkin.toLocaleDateString('tr-TR');
        } else {
            const msg = "Giriş Giriniz";
            document.getElementById('resTahliye').innerText = msg;
            document.getElementById('resTahliyeMobile').innerText = "Bekleniyor";
            document.getElementById('resBihakkin').innerText = msg;
        }
        
        // Mobil görünümde detayları otomatik aç
        if(window.innerWidth < 768) {
            document.getElementById('fullSummary').classList.remove('hidden');
        }
    }
</script>

</body>
</html>